## 📌 스레드란?
> 스레드란, 하나의 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위를 말한다. 

이해하기 쉽게 비유를 들자면, 크롬 브라우저가 실행 되면 프로세스 하나가 생성될 것이다. 그런데 우리는 브라우저에서 파일을 다운 받으며 온라인 쇼핑을 하면서 게임을 하기도 한다.

![](https://velog.velcdn.com/images/jihyun/post/70c3ead5-56d9-45d8-b64e-a06c7f13cc97/image.png)

즉, 하나의 프로세스 안에서 여러가지 작업들 흐름이 동시에 진행되기 때문에 가능한 것인데, 이러한 일련의 작업 흐름들을 `스레드`라고 하며 여러개가 있다면 이를 `멀티 스레드` 라고 부른다.

일반적으로 **하나의 프로그램**은 **하나 이상의 프로세스**를 가지고 있고, 하나의 프로세스는 반드시 **하나 이상의 스레드**를 갖는다.

<br>


## 📌 스레드의 자원 공유
스레드끼리 프로세스의 자원을 공유하면서 프로세스 실행 흐름의 일부가 되기 때문에 동시 작업이 가능하다. 

![](https://velog.velcdn.com/images/jihyun/post/595ab9a9-e2ed-4300-ba4a-5df02120e3fa/image.png)

이때 프로세스의 4가지 메모리 영역(Code, Data, Heap, Stack) 중 스레드는 Stack만 할당받아 복사하고 Code, Data, Heap은 프로세스내의 다른 스레드들과 공유된다. 따라서 각각의 스레드는 별도의 stack을 가지고 있지만 heap 메모리는 고유하기 때문에 서로 다른 스레드에서 가져와 읽고 쓸 수 있게 된다.

![](https://velog.velcdn.com/images/jihyun/post/73db3776-e2ec-4135-9226-1da7adb670cb/image.png)

이렇게 구성한 이유는 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여 자원을 공유하고, 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 올리기 위해서이다.
<br>

---

## 📌 스레드 스케쥴링

> 스레드 스케줄링은 운영체제에서 다중 스레드를 관리하며, CPU를 사용할 수 있는 스레드를 선택하고, CPU를 할당하는 작업을 말한다.

스레드 스케줄링 알고리즘 스레드의 우선순위, 실행 시간, 입출력 요청 등의 정보를 고려하여 CPU를 사용할 수 있는 스레드를 선택하는 알고리즘이다. 대표적으로는 Round Robin, 우선순위 스케줄링, Multi-level Queue scheduling 등이 있다. 다만 스레드 스케줄링은 프로세스 스케줄링과 다르게, 하나의 프로세스 내에서 다수의 스레드가 동작하는 형태이기 때문에, 스레드 간의 상호작용과 동기화 문제를 고려해야 한다는 차이점이 존재한다.

<br>

---

## 📌 스레드 상태
스레드는 일반적으로 다음과 같은 4가지 상태를 가진다.

**NEW** : 스레드가 생성되고 아직 호출되지 않은 상태

**RUNNABLE** : 스레드가 실행되기 위해 기다리는 상태CPU를 할당받을 수 있는 상태이며, 언제든지 실행될 준비가 되어있다.

**BLOCKED** : 스레드가 특정 이벤트(입출력 요청 등)가 발생하여 대기하는 상태CPU를 할당받지 못하며, 이벤트가 발생하여 다시 RUNNABLE 상태로 전환될 때까지 대기한다.

**TERMINATED** : 스레드가 실행을 완료하고 종료된 상태더 이상 실행될 수 없으며, 메모리에서 제거된다.

![](https://velog.velcdn.com/images/jihyun/post/41fe7a6c-a5c3-4a2a-8cb5-1e636f8ba1f6/image.png)


<br>

---

 
## 📌 TCB (Thread Control Block)

> TCB(스레드 제어 블록)는 각 스레드마다 운영 체제에서 유지하는 스레드에 대한 정보를 담고 있는 자료구조이다. 스레드가 프로세스 내에 위치한 것처럼 TCB도 PCB(프로세스 제어 블록) 안에 들어있다.

![](https://velog.velcdn.com/images/jihyun/post/43cee27e-3320-4f7c-9680-e1b95baf7361/image.png)

TCB는 스레드가 생성될 때 운영 체제에 의해 생성되며, 스레드가 실행을 마치고 소멸될 때 함께 소멸된다.

또한 스레드 간의 자원 공유와 동기화도 TCB를 사용하여 관리된다. 예를 들어, `뮤텍스`나 `세마포어`와 같은 동기화 기법을 사용할 때, TCB에서 해당 스레드의 뮤텍스나 세마포어 정보를 관리하고, 스레드가 해당 자원에 대한 접근 권한을 획득하거나 반납할 때 TCB의 정보를 업데이트하게 된다.
			
        
`뮤텍스(mutex)` : 임계 구역에 1개의 스레드만 들어갈 수 있는 동기화 기법.  
`세마포어(semaphore)` : 임계 구역에 여러 스레드가 들어갈 수 있고, counter를 두어서 허용 가능한 스레드를 제한하는 기법 

<br>

---

## 📌 멀티스레드란?
> 멀티 스레드는 하나의 프로세스 안에 여러개의 스레드가 있는 것을 말한다. 따라서 하나의 프로그램에서 두가지 이상의 동작을 동시에 처리하도록 하는 행위가 가능해진다.

웹 서버는 대표적인 멀티 스레드 응용 프로그램이다. 사용자가 서버 데이터베이스에 자료를 요청하는 동안 브라우저의 다른 기능을 이용할 수 있는 이유도 바로 멀티 스레드 기능 덕분인 것이다. 즉, 하나의 스레드가 지연되더라도, 다른 스레드는 작업을 지속할 수 있게 된다.

`멀티 프로세스` : 웹 브라우저에서의 여러 탭이나 여러 창  
`멀티 스레드` : 웹 브라우저 단일 창 내의 네트워크 처리, 입출력 및 기타 작업을 관리

<br>

---

## 📌 멀티스레드의 장단점

### 😊 장점
 
- **스레드는 프로세스보다 가벼움**
스레드는 프로세스 보다 용량이 가볍다. 스레드는 프로세스 내에서 생성되기 때문에 스레드의 실행 환경을 설정하는 작업이 매우 간단하여 생성 및 종료가 빠르다. 또한 스레드는 프로세스와 달리, 코드, 데이터, 스택 영역을 제외한 나머지 자원을 서로 공유하기 때문에 기본적으로 내장되어 있는 데이터 용량이 프로세스보다 당연히 작다.

-  **자원의 효율성**
멀티 스레드는 하나의 프로세스 내에서 여러 개의 스레드를 생성되기 때문에, heap 영역과 같은 공유 메모리에 대해 스레드 간에 자원을 공유가 가능하다. 이를 통해, 프로세스 간 통신 (IPC)을 사용하지 않고도 데이터를 공유할 수 있기 때문에, 자원의 효율적인 활용이 가능해 시스템 자원 소모가 줄어든다.

- **Context Switching 비용 감소**
프로세스 컨텍스트 스위칭 비용은 스위칭할 때마다 CPU 캐시에 있는 내용을 모두 초기화하고, 새로운 프로세스 정보를 CPU 캐시에 적재해야 하므로 높은 비용이 든다. 반면, 스레드 컨텍스트 스위칭 비용은 스위칭할 때 스레드 간에 공유하는 자원을 제외한 스레드 정보만을 교체하면 되므로 프로세스 컨텍스트 스위칭 비용보다 상대적으로 낮다.
 
- **응답 시간 단축**
예를 들어, 웹 서버에서 클라이언트 요청을 처리하는 경우, 멀티 프로세스 방식에서는 각 요청마다 프로세스를 생성하여 처리해야 하므로, 오버헤드가 크지만, 멀티 스레드 방식에서는 여러 개의 스레드가 하나의 프로세스 내에서 요청을 처리할 수 있으므로, 오버헤드가 감소해 더욱 빠른 응답 시간을 보장할 수 있다.
이러한 이유로, 멀티 프로세서 환경에서 멀티 스레드를 사용하여 작업을 처리하는 것이 멀티 프로세스를 사용하는 것보다 더 효율적이다라고 말할 수 있다.

<br>

### ☹️ 단점
 
- **안정성 문제**
멀티 프로세스 모델에서는 각 프로세스가 독립적으로 동작하므로 하나의 프로세스에서 문제가 발생해도 다른 프로세스들은 영향을 받지 않기 때문에 프로그램이 죽지 않고 계속 동작할 수 있다. 그러나 멀티 스레드 모델에서는 기본적으로 하나의 스레드에서 문제가 발생하면 다른 스레드들도 영향을 받아 전체 프로그램이 종료될 수 있다.

- **동기화로 인한 성능 저하**
멀티 스레드 모델은 여러 개의 스레드가 공유 자원에 동시에 접근할 수 있기 때문에, 동기화 문제가 발생할 수 있다. 예를 들어 여러 스레드가 동시에 한 자원을 변경해 버린다면 엉뚱한 값을 읽어 서비스에 버그가 생길 수 있다. 따라서 스레드 간 동기화는 데이터 접근을 제어하기 위한 필수적인 기술이다. 
그러나 동기화 작업은 여러 스레드 접근을 제한하는 것이기 때문에 병목 현상이 일어나 성능이 저하될 가능성이 높다는 단점이 있다. 이를 해결하기 위해 임계 영역에 대하여 `뮤텍스(mutex)`, 또는 `세마포어(Semaphore)` 방식을 활용한다.        
 
- **데드락 (교착 상태)**
Deadlock 이란, 다수의 프로세스나 스레드가 서로 자원을 점유하고, 다른 프로세스나 스레드가 점유한 자원을 기다리는 상황에서 발생하는 교착 상태를 말한다. 다수의 스레드가 같은 lock을 동시에, 다른 명령에 의해 획득하려 할 때 여러 개의 스레드가 서로 대기하면서 무한정 기다리게되는 **무한 루프** 현상이 발생할 수 있다.

<br>

---
 


## 📌 멀티 스레드 VS 멀티 프로세스

> 두 방법은 동시에 여러 작업을 수행한다는 측면에서 유사한 면이 있다.
적용할 시스템에 따라 두 방법의 장단점을 고려하여 적합한 방식을 선택해야 한다.

![](https://velog.velcdn.com/images/jihyun/post/61c67a98-a469-4512-a335-e25ad3267c92/image.png)


- 멀티 스레드는 멀티 프로세스보다 적은 메모리 공간을 차지하고 Context Switching이 빠르다.

- 멀티 프로세스는 멀티 스레드보다 많은 메모리 공간과 CPU 시간을 차지한다.

- 멀티 스레드는 동기화 문제와 하나의 스레드 장애로 전체 스레드가 종료될 위험이 있다.

- 멀티 프로세스는 하나의 스레드가 죽더라도 다른 프로세스에 영향을 주지 않아 안정성이 높다.

<br>

||메모리 사용+CPU 시간|Context switching|안전성|
|---|---|:---:|:---:|
|**멀티 프로세스**|많은 메모리 공간+CPU 시간 차지|느림|높음|
|**멀티 스레드**|적은 메모리 공간+CPU 시간 차지|빠름|낮음|

<br>

#### 🤔 멀티프로세스와 멀티스레드 중 어떤 것을 사용해야할까?

`멀티 프로세스` : 메모리 구분이 필요할 때
`멀티 스레드` : 컨텍스트 스위칭이 자주 일어나고 데이터 공유가 빈번한 경우, 자원을 효율적으로 사용해야 되는 경우

